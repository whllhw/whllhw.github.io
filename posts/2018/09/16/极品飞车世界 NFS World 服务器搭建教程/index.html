<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="极品飞车世界 NFS World 服务器搭建教程"><meta name="keywords" content="java"><meta name="author" content="whllhw"><meta name="copyright" content="whllhw"><title>极品飞车世界 NFS World 服务器搭建教程 | 仰头45℃爆笑</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-126824460-1', 'auto');
ga('send', 'pageview');</script><meta name="google-site-verification" content="googleaf4c29130aaf2b72.html"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">不推荐的方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#搭建前提"><span class="toc-number">2.1.</span> <span class="toc-text">搭建前提</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-mysql-数据库"><span class="toc-number">2.2.</span> <span class="toc-text">1. MySQL 数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-openfire-配置"><span class="toc-number">2.3.</span> <span class="toc-text">2.openfire 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-nfsw-server-配置"><span class="toc-number">2.4.</span> <span class="toc-text">3.nfsw-server 配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">enjoy！</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/images/avatar.png"></div><div class="author-info__name text-center">whllhw</div><div class="author-info__description text-center">生活不止眼前的苟且，还有读不懂的诗和到不了的远方</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">37</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">19</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">仰头45℃爆笑</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">极品飞车世界 NFS World 服务器搭建教程</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-16</time><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">1.1k</span><span class="post-meta__separator">|</span><span>Reading time: 3 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><blockquote>
<p>本篇文章主要讲搭建过程，以及出现问题的解决方法。难度较高，我已经搭建好了服务器供玩耍，如何连接服务器看<a href="">这篇文章</a>或者 <a href="https://www.jianshu.com/p/23bcb1dcbe26" target="_blank" rel="noopener">简书</a></p>
</blockquote>
<h1>不推荐的方法</h1>
<p>我先找到 github <a href="https://github.com/SoapboxRaceWorld/soapbox-race-core" target="_blank" rel="noopener">SoapboxRaceWorld</a>上面的开源服务器，尝试了很久，最后搭建好了之后发现游戏中购车的界面进不去，在后台数据库发现少数据，但是我已经全部导入了的😂<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-481f81f16c4de4f1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="缺少表"><br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-af34e1c7d352abb5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="在代码里面搜索，能在代码里找到，给的SQL文件里面没有。"></p>
<p>既然已经不推荐用这种方法了，可以跳过这里。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10215367-a65815bd7e0c07d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="已经一年没更新了"><br>
打包出来的是 war ，需要 wildfly 才能部署，需要做的事情如下：</p>
<ol>
<li>下载 releases 打包好的 war，以及 wiki 里提供的 <a href="https://github.com/SoapboxRaceWorld/soapbox-race-core/wiki/Wildfly" target="_blank" rel="noopener">wildfly</a> （google drive 要梯子）</li>
<li>放入 war 到 wildfly 目录下的 standalone/deployments<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-27c7690cb692e51f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="war 包放入这个文件夹"></li>
<li>配置 openfire 服务 （配置文件 wildfly/standalone/configuration/standalone.xml）<br>
配置 xmppIp 为公网地址（必须检查）<br>
Udp freeroam、race 都是未完成的功能（私服官方到现在都没搞定😂我也不知道是什么功能）<br>
配置 openfire restful api 地址<br>
配置 openfire token<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-2dd9d478730bda3d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="standalone.xml 中系统属性示例"><br>
也可以登录wildfly 后台修改http://localhost:9990/console/App.html#profile/properties（需要创建账户，运行 <a href="http://add-user.sh" target="_blank" rel="noopener">add-user.sh</a> 按提示即可）。<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-417366ed002f7a25.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="系统属性配置"></li>
<li>配置数据库，同样可以编辑 xml 也可以登录后台数据源配置<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-99b3df61bcaa0f57.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="默认用户密码 soapbox soapbox"><br>
5.（可选）配置绑定的后台管理地址<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-43948106498e3815.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="默认绑定127.0.0.1，docker镜像我改成0.0.0.0了"></li>
<li>可在后台重启服务<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-e71f34fa506ec8af.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="重新加载服务"></li>
</ol>
<hr>
<h1>正文</h1>
<p>wiki 给出需要用到服务 openfire 、mysql 、wildfly（后面我找到了 nfsw-server.jar替换掉）都需要用到数据库，所以先从数据库开始吧。<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-2a7052fc6c9f35db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="来源 https://github.com/SoapboxRaceWorld/soapbox-race-core/wiki/How-does-it-work?"></p>
<h2 id="搭建前提">搭建前提</h2>
<p>有 1G 以上的内存，公网IP（如果只是要本地，直接下一个模拟器就好了，不用这么麻烦。），最好 Linux 主机，windows 没试过，不过应该也行。</p>
<h2 id="1-mysql-数据库">1. MySQL 数据库</h2>
<ol>
<li>导入<a href="https://github.com/whllhw/nfsw-server/blob/master/db/OPENFIRE.sql" target="_blank" rel="noopener">OPENFIRE.sql</a>，<a href="https://github.com/whllhw/nfsw-server/blob/master/db/soapbox.sql" target="_blank" rel="noopener">soapbox.sql</a>（修改后从数据库导出的，原来的 db.sql 有点问题，soapbox 数据库大小写没对上😂）<br>
默认openfire用户名：openfire 密码 openfire<br>
默认soapbox用户名：soapbox 密码soapbox<br>
PS：不用来试我数据库了，没开放3306端口，我是用SSH通道用密钥连接的。</li>
<li>保持数据运行就好了</li>
</ol>
<h2 id="2-openfire-配置">2.openfire 配置</h2>
<p>如 wiki 写的一样<a href="https://github.com/SoapboxRaceWorld/soapbox-race-core/wiki/OpenFire" target="_blank" rel="noopener">OpenFire</a>从 google drive下载。<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-19953b811b7fd089.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.配置数据库连接"><br>
登录后台，admin 密码 admin<br>
访问 localhost:9090/plugins/restapi/rest-api.jsp 启用 restful api 把 openfire token 保存下来配置nfsw-server需要用到<br>
登录后台 localhost:9090/server-properties.jsp<br>
Xmpp.domain 改为与后面的nfsw-server.cfg中xmppIp一样的地址<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-cf73df842d711753.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.配置Xmpp.domain 一般为内网 ip （使用外网ip的话云服务一般都要去配置安全组，openfire 只要能访问就行了）"><br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-52e422b7c147aca1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="配置Xmpp.domain错误导致连接的时候会检验 Host 字段，不相同则无法建立连接，无法使用聊天服务"><br>
运行 <code>openfire/bin/openfire start</code>让其在后台运行即可。<br>
日志文件在 <code>openfire/logs/</code>目录下，有问题时可以使用<code>tailf openfire/logs/all.log</code>持续查看输出，方便找配置错误，当没有报数据库连不上，没有打印出一些堆栈时就可配置nfsw-server了，否则检查配置是否有误。</p>
<h2 id="3-nfsw-server-配置">3.nfsw-server 配置</h2>
<p><a href="https://github.com/whllhw/nfsw-server/releases" target="_blank" rel="noopener">在github下载nfsw-server.jar、nfsw-server.cfg</a>也可以自己编译，下载 jdk、maven执行 <code>mvn clean compile assembly:single</code></p>
<ol start="0">
<li>
<p>配置数据库连接（src/main/resources/META-INF/persistence.xml）使用打包的话可以先替换掉压缩包里的 xml<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-ebd0debfd07f5f2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="如果不改用户名密码的话配置好url即可，或者添加 host 解析nfsw-server 到ip地址127.0.0.1 也可以"></p>
</li>
<li>
<p>在nfsw-server.cfg中配置xmppIp（在openfire配置的xmpp.domain 一定要一样，否则报错 <code>Unable to authenticate: Fail to create new session.</code>）</p>
</li>
<li>
<p>openfireToken（在openfire配置的openfireToken）</p>
</li>
<li>
<p>httpPort是游戏开放端口，我用的是1337（外网开放1337端口）<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-476964e1a7c54e06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="其他没提到的就和上图一样就好了"></p>
</li>
<li>
<p>nfsw-server.cfg，nfsw-server.jar 放在同一目录下执行<code>java -jar nfsw-server.jar</code><br>
注意看输出，先连接 openfire restful api 返回 201说明 openfire 连接成功<br>
<img src="https://upload-images.jianshu.io/upload_images/10215367-73ba3c1133550a6b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="201才表示连接成功"><br>
然后连接数据库，当没有报数据库连不上，没有打印出一些堆栈时就可应该可以了，否则检查配置是否有误。</p>
</li>
</ol>
<h1>enjoy！</h1>
<p>nfsw 服务搭建已经完成，在开头的文章下载 nfsw 以及启动器就可以登录了！等会再写一篇客户端登录的教程<br>
PS：我准备把这个服务做成 docker 镜像，这样部署的时候就不用这么配来配去（自己捣鼓了差不多一个星期才搞定，先是 wildfly 搭建的数据库缺数据，无法购买车辆，后是 openfire 中 xmpp.domain 配置错误，进入游戏就提示与服务器断开连接，其实是跨域的问题，nfsw-server的xmppIp要与其相同。）<br>
上面项目都是基本已经停止维护的，使用的 openfire 是4.0.2 的，我fork的老哥<a href="https://github.com/michelinus" target="_blank" rel="noopener">michelinus</a>/**<a href="https://github.com/michelinus/nfsw-server" target="_blank" rel="noopener">nfsw-server</a>**也停止更新一年了。<br>
有问题可以在下面留言哦，欢迎一起交流（虽然极大可能零回复）</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">whllhw</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://whllhw.ml/posts/2018/09/16/极品飞车世界 NFS World 服务器搭建教程/">https://whllhw.ml/posts/2018/09/16/极品飞车世界 NFS World 服务器搭建教程/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/posts/2018/09/16/连接到极品飞车世界 CN 服务器/"><i class="fa fa-chevron-left">  </i><span>连接到极品飞车世界 CN 服务器</span></a></div><div class="next-post pull-right"><a href="/posts/2018/09/10/Visual Studio 2017 无法登陆提示脚本错误/"><span>Visual Studio 2017 无法登陆提示脚本错误</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2016 - 2020 By whllhw</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>